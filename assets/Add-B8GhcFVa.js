import{_ as le,r as i,X as _,w as te,c,e as l,x as ne,y as oe,b as d,a4 as ue,q as s,j as p,J as F,f as t,p as A,V as I,D as k,m as N,g as x,aa as R,C as g,G as D,H as K,I as M,K as se,u as re,z as ie,B as de}from"./index-TexIIK_8.js";import{u as me}from"./quickShareStore-DAg6hWQ2.js";import{V as ve}from"./VTextarea-CB8mBJHe.js";import{V as ce}from"./VChip-Bkw_wO1V.js";import{V as Q,b as $,a as j,d as pe}from"./VList-74BXSDpy.js";import{V as O}from"./VSpacer-CEFGUlLq.js";import{V as fe}from"./VDialog-RfSF4Tuc.js";import"./ssrBoot-CLhRb1dG.js";import"./dialog-transition-D7ZCLFfu.js";const be={class:"add-person-form pa-4"},Ve={class:"d-flex align-center gap-4"},ge={class:"flex-grow-1"},ye={class:"d-flex align-center"},ke={key:1,class:"text-center pa-4 text-medium-emphasis"},xe={__name:"Add",setup(Se){const G=oe(),n=i({title:"",amount:"",description:""}),y=i(""),b=i(""),S=i(""),m=i([]),V=i([]),B=i(""),f=i(""),P=i(!1),h=i(!1),U=i(!1),q=me(),L=i(""),H=_(()=>Number(n.value.amount)/m.value.length),w=_(()=>{const r=Number(n.value.amount)||0,e=m.value.reduce((a,o)=>a+o.amount,0);return(r-e).toFixed(2)}),E=_(()=>y.value&&b.value&&!f.value&&Number(w.value)>=0),J=_(()=>n.value.title&&n.value.amount>0&&m.value.length>=2&&Number(w.value)===0),W=()=>{const r=Number(b.value),e=Number(w.value);r<0?f.value="Amount must not be negative":r>e?f.value=`Amount cannot exceed remaining balance (â‚¹${e})`:f.value=""},T=()=>{E.value&&(m.value.push({name:y.value,amount:Number(b.value),email:S.value}),y.value="",b.value="",f.value="",S.value="")},X=r=>{m.value.splice(r,1),z()},Y=()=>{const r=Number(n.value.amount)/m.value.length,e=m.value.map(u=>({name:u.name,balance:u.amount-r})),a=e.filter(u=>u.balance<0).sort((u,v)=>u.balance-v.balance),o=e.filter(u=>u.balance>0).sort((u,v)=>v.balance-u.balance);for(V.value=[];a.length&&o.length;){const u=a[0],v=o[0],C=Math.min(Math.abs(u.balance),v.balance);C>0&&V.value.push({from:u.name,to:v.name,amount:C.toFixed(2)}),u.balance+=C,v.balance-=C,Math.abs(u.balance)<.01&&a.shift(),Math.abs(v.balance)<.01&&o.shift(),P.value=!0}},Z=()=>{h.value=!0;const r={title:n.value.title,total_amount:n.value.amount,description:n.value.description,bill_members:m.value};q.saveQuickShare(r).then(e=>{L.value=e.data.data,U.value=!0,h.value=!1}).catch(e=>{h.value=!1,B.value=e.message})},ee=async()=>{const e=`${window.location.origin}/quickshare/detail/${q.lastSavedId}`,a=`ðŸ§¾ ${n.value.title}
ðŸ’° Total: â‚¹${n.value.amount}

ðŸ“ Settlements:
${V.value.map(o=>`â€¢ ${o.from} â†’ ${o.to}: â‚¹${o.amount}`).join(`
`)}

ðŸ”— ${e}`;try{navigator.share?await navigator.share({title:"ðŸ’° Bill Settlement",text:a,url:L.value}):(await navigator.clipboard.writeText(a),showCopySnackbar.value=!0)}catch(o){console.error("Share failed:",o)}},ae=r=>`https://ui-avatars.com/api/?name=${encodeURIComponent(r)}&background=random`,z=()=>{V.value=[],P.value=!1};return te(()=>n.value.amount,z),(r,e)=>(d(),c(ne,{class:"py-4"},{default:l(()=>[B.value?(d(),c(ue,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:""},{default:l(()=>[s(p(B.value),1)]),_:1})):F("",!0),t(N,{class:"mb-4"},{default:l(()=>[t(A,null,{default:l(()=>e[8]||(e[8]=[s("Bill Details")])),_:1}),t(I,null,{default:l(()=>[t(k,{modelValue:n.value.title,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.title=a),label:"Bill Title",variant:"outlined",rules:[a=>!!a||"Title is required"]},null,8,["modelValue","rules"]),t(ve,{modelValue:n.value.description,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.description=a),label:"Description (Optional)",variant:"outlined",rows:"3",class:"mt-2",counter:"200",rules:[a=>!a||a.length<=200||"Description must be less than 200 characters"]},null,8,["modelValue","rules"]),t(k,{modelValue:n.value.amount,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.amount=a),label:"Total Amount",type:"number",variant:"outlined",prefix:"Rs",rules:[a=>!!a||"Amount is required",a=>a>0||"Amount must be greater than 0"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(N,{class:"mb-4"},{default:l(()=>[t(A,{class:"d-flex align-center"},{default:l(()=>[e[9]||(e[9]=s(" People ")),t(ce,{class:"ml-2",color:"primary",size:"small"},{default:l(()=>[s(" Remaining: â‚¹"+p(w.value),1)]),_:1})]),_:1}),t(I,null,{default:l(()=>[x("div",be,[x("div",Ve,[x("div",ge,[t(k,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a),label:"Name",variant:"outlined",density:"comfortable",class:"mb-3",onKeyup:R(T,["enter"]),rules:[a=>!!a||"Name is required"]},null,8,["modelValue","rules"]),t(k,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=a=>b.value=a),label:"Paid Amount",type:"number",variant:"outlined",density:"comfortable",prefix:"â‚¹",error:!!f.value,"error-messages":f.value,onInput:W},null,8,["modelValue","error","error-messages"]),t(k,{modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=a=>S.value=a),label:"Email (Optional)",variant:"outlined",density:"comfortable",class:"mb-3",onKeyup:R(T,["enter"]),rules:[a=>!a||/.+@.+\..+/.test(a)||"Email must be valid if provided",a=>!a||a.length<=50||"Email must be less than 50 characters"]},null,8,["modelValue","rules"])]),x("div",ye,[t(g,{color:"primary",icon:"mdi-plus",size:"large",onClick:T,disabled:!E.value},null,8,["disabled"])])])]),m.value.length?(d(),c(Q,{key:0},{default:l(()=>[(d(!0),D(M,null,K(m.value,(a,o)=>(d(),c(j,{key:o,subtitle:`Paid: â‚¹${a.amount}`},{prepend:l(()=>[t(ie,{image:ae(a.name)},null,8,["image"])]),append:l(()=>[t(g,{icon:"mdi-delete",variant:"text",color:"error",onClick:u=>X(o)},null,8,["onClick"])]),default:l(()=>[t($,null,{default:l(()=>[s(p(a.name),1)]),_:2},1024),t($,null,{default:l(()=>[s(p(a.email),1)]),_:2},1024)]),_:2},1032,["subtitle"]))),128))]),_:1})):(d(),D("div",ke," No People added yet "))]),_:1})]),_:1}),V.value.length?(d(),c(N,{key:1,class:"mb-4"},{default:l(()=>[t(A,{class:"d-flex align-center"},{default:l(()=>[e[10]||(e[10]=s(" Settlements ")),t(O),t($,null,{default:l(()=>[s(" Per Person: "+p(H.value.toFixed(2)),1)]),_:1})]),_:1}),t(Q,null,{default:l(()=>[(d(!0),D(M,null,K(V.value,(a,o)=>(d(),c(j,{key:o},{prepend:l(()=>[t(de,{color:"info"},{default:l(()=>e[11]||(e[11]=[s("mdi-arrow-right")])),_:1})]),default:l(()=>[t($,null,{default:l(()=>[s(p(a.from)+" pays "+p(a.to),1)]),_:2},1024),t(pe,null,{default:l(()=>[s(" â‚¹"+p(a.amount),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):F("",!0),P.value?(d(),c(g,{key:3,block:"",loading:h.value,color:"primary",size:"large",onClick:Z},{default:l(()=>e[13]||(e[13]=[s(" Save Settlements ")])),_:1},8,["loading"])):(d(),c(g,{key:2,block:"",color:"primary",size:"large",disabled:!J.value,onClick:Y},{default:l(()=>e[12]||(e[12]=[s(" Calculate Split ")])),_:1},8,["disabled"])),t(fe,{modelValue:U.value,"onUpdate:modelValue":e[7]||(e[7]=a=>U.value=a),"max-width":"400"},{default:l(()=>[t(N,null,{default:l(()=>[t(A,null,{default:l(()=>e[14]||(e[14]=[s("Share Bill")])),_:1}),t(I,null,{default:l(()=>e[15]||(e[15]=[x("p",null,"Bill saved successfully! Would you like to share it now?",-1)])),_:1}),t(se,null,{default:l(()=>[t(O),t(g,{color:"grey",variant:"text",onClick:e[6]||(e[6]=a=>re(G).push("/quickshare"))},{default:l(()=>e[16]||(e[16]=[s(" Later ")])),_:1}),t(g,{color:"primary",onClick:ee},{default:l(()=>e[17]||(e[17]=[s(" Share Now ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ue=le(xe,[["__scopeId","data-v-b960520b"]]);export{Ue as default};
