import{_ as ee,b as i,c as p,e as l,f as e,m as _,p as x,V as A,g as y,G as N,I as E,H as L,x as te,r as m,X as f,w as me,o as ce,y as ve,a6 as pe,a4 as fe,q as r,j as g,J,D,aa as W,C,K as be,u as ge,z as ye,B as Ve}from"./index-TexIIK_8.js";import{u as _e}from"./quickShareStore-DAg6hWQ2.js";import{V as d}from"./VSkeletonLoader-B1CngXHA.js";import{V as xe}from"./VTextarea-CB8mBJHe.js";import{V as he}from"./VChip-Bkw_wO1V.js";import{V as X,b as I,a as Y,d as ke}from"./VList-74BXSDpy.js";import{V as Z}from"./VSpacer-CEFGUlLq.js";import{V as we}from"./VDialog-RfSF4Tuc.js";import"./ssrBoot-CLhRb1dG.js";import"./dialog-transition-D7ZCLFfu.js";const Ce={},$e={class:"d-flex align-center"},De={class:"add-person-form pa-4"},Ae={class:"d-flex align-center justify-space-between"};function Ne(ae,j){return i(),p(te,{class:"py-4"},{default:l(()=>[e(_,{class:"mb-4"},{default:l(()=>[e(x,null,{default:l(()=>[e(d,{type:"text",width:"120"})]),_:1}),e(A,null,{default:l(()=>[e(d,{type:"text",class:"mb-4"}),e(d,{type:"text",class:"mb-4",height:"100"}),e(d,{type:"text"})]),_:1})]),_:1}),e(_,{class:"mb-4"},{default:l(()=>[e(x,null,{default:l(()=>[y("div",$e,[e(d,{type:"text",width:"80"}),e(d,{type:"chip",width:"100",class:"ml-2"})])]),_:1}),e(A,null,{default:l(()=>[y("div",De,[e(d,{type:"article",height:"200"})]),(i(),N(E,null,L(3,h=>e(d,{key:h,type:"list-item-avatar-two-line",class:"mb-2"})),64))]),_:1})]),_:1}),e(_,{class:"mb-4"},{default:l(()=>[e(x,null,{default:l(()=>[y("div",Ae,[e(d,{type:"text",width:"100"}),e(d,{type:"text",width:"120"})])]),_:1}),(i(),N(E,null,L(3,h=>e(d,{key:h,type:"list-item-two-line",class:"mb-2"})),64))]),_:1}),e(d,{type:"button",width:"100%"})]),_:1})}const Se=ee(Ce,[["render",Ne],["__scopeId","data-v-d2ca7677"]]),Ue={class:"add-person-form pa-4"},Be={class:"d-flex align-center gap-4"},Pe={class:"flex-grow-1"},Te={class:"d-flex align-center"},Ie={key:1,class:"text-center pa-4 text-medium-emphasis"},Ee={__name:"Edit",setup(ae){const j=ve(),h=pe(),q=m(!0),$=m(""),k=m(""),S=m(""),w=m([]),R=m(""),V=m(""),z=m(!1),U=m(!1),F=m(!1),s=_e(),O=m(""),c=f(()=>({title:M.value,amount:B.value,description:K.value})),M=f({get:()=>{var n;return(n=s==null?void 0:s.getDetail)==null?void 0:n.title},set:n=>s.quickShareDetail.title=n}),K=f({get:()=>{var n;return(n=s==null?void 0:s.getDetail)==null?void 0:n.description},set:n=>s.quickShareDetail.description=n}),B=f({get:()=>{var n;return(n=s==null?void 0:s.getDetail)==null?void 0:n.total_amount},set:n=>s.quickShareDetail.total_amount=n}),v=f({get:()=>{var n;return(n=s==null?void 0:s.getDetail)==null?void 0:n.bill_members},set:n=>s.quickShareDetail.bill_members=n}),le=f(()=>Number(c.value.amount)/v.value.length),P=f(()=>{const n=Number(B.value)||0,t=v.value.reduce((a,u)=>a+u.amount,0);return(n-t).toFixed(2)}),G=f(()=>$.value&&k.value&&!V.value&&Number(P.value)>=0),ne=f(()=>c.value.title&&c.value.amount>0&&v.value.length>=2&&Number(P.value)===0),se=()=>{const n=Number(k.value),t=Number(P.value);n<0?V.value="Amount must not be negative":n>t?V.value=`Amount cannot exceed remaining balance (â‚¹${t})`:V.value=""},Q=()=>{G.value&&(v.value.push({name:$.value,amount:Number(k.value),email:S.value}),$.value="",k.value="",V.value="",S.value="")},ue=n=>{v.value.splice(n,1),H()},oe=()=>{const n=Number(c.value.amount)/v.value.length,t=v.value.map(o=>({name:o.name,balance:o.amount-n})),a=t.filter(o=>o.balance<0).sort((o,b)=>o.balance-b.balance),u=t.filter(o=>o.balance>0).sort((o,b)=>b.balance-o.balance);for(w.value=[];a.length&&u.length;){const o=a[0],b=u[0],T=Math.min(Math.abs(o.balance),b.balance);T>0&&w.value.push({from:o.name,to:b.name,amount:T.toFixed(2)}),o.balance+=T,b.balance-=T,Math.abs(o.balance)<.01&&a.shift(),Math.abs(b.balance)<.01&&u.shift(),z.value=!0}},re=()=>{U.value=!0;const n={title:c.value.title,total_amount:c.value.amount,description:c.value.description,bill_members:v.value};s.updateQuickShare(h.params.id,n).then(t=>{O.value=t.data.data,F.value=!0,U.value=!1}).catch(t=>{U.value=!1,R.value=t.message})},ie=async()=>{const t=`${window.location.origin}/quickshare/detail/${s.lastSavedId}`,a=`ðŸ§¾ ${c.value.title}
ðŸ’° Total: â‚¹${c.value.amount}

ðŸ“ Settlements:
${w.value.map(u=>`â€¢ ${u.from} â†’ ${u.to}: â‚¹${u.amount}`).join(`
`)}

ðŸ”— ${t}`;try{navigator.share?await navigator.share({title:"ðŸ’° Bill Settlement",text:a,url:O.value}):(await navigator.clipboard.writeText(a),showCopySnackbar.value=!0)}catch(u){console.error("Share failed:",u)}},de=n=>`https://ui-avatars.com/api/?name=${encodeURIComponent(n)}&background=random`,H=()=>{w.value=[],z.value=!1};return me(()=>c.value.amount,H),ce(()=>{s.fetchDetail(h.params.id).then(()=>{q.value=!1})}),(n,t)=>q.value?(i(),p(Se,{key:0})):(i(),p(te,{key:1,class:"py-4"},{default:l(()=>[R.value?(i(),p(fe,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:""},{default:l(()=>[r(g(R.value),1)]),_:1})):J("",!0),e(_,{class:"mb-4"},{default:l(()=>[e(x,null,{default:l(()=>t[8]||(t[8]=[r("Bill Details")])),_:1}),e(A,null,{default:l(()=>[e(D,{modelValue:M.value,"onUpdate:modelValue":t[0]||(t[0]=a=>M.value=a),label:"Bill Title",variant:"outlined",rules:[a=>!!a||"Title is required"]},null,8,["modelValue","rules"]),e(xe,{modelValue:K.value,"onUpdate:modelValue":t[1]||(t[1]=a=>K.value=a),label:"Description (Optional)",variant:"outlined",rows:"3",class:"mt-2",counter:"200",rules:[a=>!a||a.length<=200||"Description must be less than 200 characters"]},null,8,["modelValue","rules"]),e(D,{modelValue:B.value,"onUpdate:modelValue":t[2]||(t[2]=a=>B.value=a),label:"Total Amount",type:"number",variant:"outlined",prefix:"Rs",rules:[a=>!!a||"Amount is required",a=>a>0||"Amount must be greater than 0"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(_,{class:"mb-4"},{default:l(()=>[e(x,{class:"d-flex align-center"},{default:l(()=>[t[9]||(t[9]=r(" People ")),e(he,{class:"ml-2",color:"primary",size:"small"},{default:l(()=>[r(" Remaining: â‚¹"+g(P.value),1)]),_:1})]),_:1}),e(A,null,{default:l(()=>[y("div",Ue,[y("div",Be,[y("div",Pe,[e(D,{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=a=>$.value=a),label:"Name",variant:"outlined",density:"comfortable",class:"mb-3",onKeyup:W(Q,["enter"]),rules:[a=>!!a||"Name is required"]},null,8,["modelValue","rules"]),e(D,{modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=a=>k.value=a),label:"Paid Amount",type:"number",variant:"outlined",density:"comfortable",prefix:"â‚¹",error:!!V.value,"error-messages":V.value,onInput:se},null,8,["modelValue","error","error-messages"]),e(D,{modelValue:S.value,"onUpdate:modelValue":t[5]||(t[5]=a=>S.value=a),label:"Email (Optional)",variant:"outlined",density:"comfortable",class:"mb-3",onKeyup:W(Q,["enter"]),rules:[a=>!a||/.+@.+\..+/.test(a)||"Email must be valid if provided",a=>!a||a.length<=50||"Email must be less than 50 characters"]},null,8,["modelValue","rules"])]),y("div",Te,[e(C,{color:"primary",icon:"mdi-plus",size:"large",onClick:Q,disabled:!G.value},null,8,["disabled"])])])]),v.value.length?(i(),p(X,{key:0},{default:l(()=>[(i(!0),N(E,null,L(v.value,(a,u)=>(i(),p(Y,{key:u,subtitle:`Paid: â‚¹${a.amount}`},{prepend:l(()=>[e(ye,{image:de(a.name)},null,8,["image"])]),append:l(()=>[e(C,{icon:"mdi-delete",variant:"text",color:"error",onClick:o=>ue(u)},null,8,["onClick"])]),default:l(()=>[e(I,null,{default:l(()=>[r(g(a.name),1)]),_:2},1024),e(I,null,{default:l(()=>[r(g(a.email),1)]),_:2},1024)]),_:2},1032,["subtitle"]))),128))]),_:1})):(i(),N("div",Ie," No People added yet "))]),_:1})]),_:1}),w.value.length?(i(),p(_,{key:1,class:"mb-4"},{default:l(()=>[e(x,{class:"d-flex align-center"},{default:l(()=>[t[10]||(t[10]=r(" Settlements ")),e(Z),e(I,null,{default:l(()=>[r(" Per Person: "+g(le.value.toFixed(2)),1)]),_:1})]),_:1}),e(X,null,{default:l(()=>[(i(!0),N(E,null,L(w.value,(a,u)=>(i(),p(Y,{key:u},{prepend:l(()=>[e(Ve,{color:"info"},{default:l(()=>t[11]||(t[11]=[r("mdi-arrow-right")])),_:1})]),default:l(()=>[e(I,null,{default:l(()=>[r(g(a.from)+" pays "+g(a.to),1)]),_:2},1024),e(ke,null,{default:l(()=>[r(" â‚¹"+g(a.amount),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):J("",!0),z.value?(i(),p(C,{key:3,block:"",loading:U.value,color:"primary",size:"large",onClick:re},{default:l(()=>t[13]||(t[13]=[r(" Update Settlements ")])),_:1},8,["loading"])):(i(),p(C,{key:2,block:"",color:"primary",size:"large",disabled:!ne.value,onClick:oe},{default:l(()=>t[12]||(t[12]=[r(" Calculate Split ")])),_:1},8,["disabled"])),e(we,{modelValue:F.value,"onUpdate:modelValue":t[7]||(t[7]=a=>F.value=a),"max-width":"400"},{default:l(()=>[e(_,null,{default:l(()=>[e(x,null,{default:l(()=>t[14]||(t[14]=[r("Share Bill")])),_:1}),e(A,null,{default:l(()=>t[15]||(t[15]=[y("p",null,"Bill saved successfully! Would you like to share it now?",-1)])),_:1}),e(be,null,{default:l(()=>[e(Z),e(C,{color:"grey",variant:"text",onClick:t[6]||(t[6]=a=>ge(j).push("/quickshare"))},{default:l(()=>t[16]||(t[16]=[r(" Later ")])),_:1}),e(C,{color:"primary",onClick:ie},{default:l(()=>t[17]||(t[17]=[r(" Share Now ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ge=ee(Ee,[["__scopeId","data-v-bf997ea8"]]);export{Ge as default};
