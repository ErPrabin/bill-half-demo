import{r as b,X as V,c as f,e as a,x as F,a6 as J,y as P,b as u,f as o,V as k,g as m,k as U,l as B,j as p,m as c,p as y,q as n,G as S,H as _,I as w,C,K as D,B as j,J as H,a5 as q}from"./index-TexIIK_8.js";import{V as A,a as h}from"./VList-74BXSDpy.js";import{V as I}from"./VSpacer-CEFGUlLq.js";import{V as z}from"./VDialog-RfSF4Tuc.js";import"./ssrBoot-CLhRb1dG.js";import"./dialog-transition-D7ZCLFfu.js";const G={class:"text-body-1"},K={class:"text-h6"},et={__name:"Settle",setup(O){const M=J(),T=P(),v=b(!1),d=b(!1),r=b({startDate:"2024-03-01",totalAmount:7e3,bills:[{id:1,title:"Hotel",amount:5e3,addedBy:"John"},{id:2,title:"Dinner",amount:2e3,addedBy:"Alice"}],members:["John","Alice","Bob"]}),g=V(()=>{const s={};return r.value.members.forEach(t=>{s[t]=0}),r.value.bills.forEach(t=>{const e=t.amount/r.value.members.length;s[t.addedBy]+=t.amount,r.value.members.forEach(l=>{s[l]-=e})}),Object.entries(s).map(([t,e])=>({member:t,amount:Number(e.toFixed(2))}))}),x=V(()=>{const s=[...g.value],t=[];for(s.sort((e,l)=>e.amount-l.amount);s.length>1;){const e=s[0],l=s[s.length-1],i=Math.min(Math.abs(e.amount),l.amount);i>0&&t.push({from:e.member,to:l.member,amount:i.toFixed(2),settled:!1}),e.amount+=i,l.amount-=i,Math.abs(e.amount)<.01&&s.shift(),Math.abs(l.amount)<.01&&s.pop()}return t}),$=V(()=>x.value.length>0),E=()=>{d.value=!0},N=async()=>{v.value=!0;try{await new Promise(s=>setTimeout(s,1e3)),T.push(`/groups/${M.params.groupId}`)}finally{v.value=!1,d.value=!1}},L=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),R=s=>`https://ui-avatars.com/api/?name=${encodeURIComponent(s)}&background=random`;return(s,t)=>(u(),f(F,{class:"py-4"},{default:a(()=>[o(c,{class:"mb-4"},{default:a(()=>[o(k,null,{default:a(()=>[t[4]||(t[4]=m("div",{class:"text-h6 mb-2"},"Episode Summary",-1)),o(U,null,{default:a(()=>[o(B,{cols:"6"},{default:a(()=>[t[2]||(t[2]=m("div",{class:"text-caption"},"Period",-1)),m("div",G,p(L(r.value.startDate)),1)]),_:1}),o(B,{cols:"6"},{default:a(()=>[t[3]||(t[3]=m("div",{class:"text-caption"},"Total Amount",-1)),m("div",K,"₹"+p(r.value.totalAmount),1)]),_:1})]),_:1})]),_:1})]),_:1}),o(c,{class:"mb-4"},{default:a(()=>[o(y,null,{default:a(()=>t[5]||(t[5]=[n("Settlement Instructions")])),_:1}),o(A,null,{default:a(()=>[(u(!0),S(w,null,_(x.value,(e,l)=>(u(),f(h,{key:l,"prepend-avatar":R(e.from),title:`${e.from} pays ${e.to}`,subtitle:`₹${e.amount}`},{append:a(()=>[e.settled?(u(),f(j,{key:0,color:"success"},{default:a(()=>t[6]||(t[6]=[n("mdi-check")])),_:1})):H("",!0)]),_:2},1032,["prepend-avatar","title","subtitle"]))),128))]),_:1})]),_:1}),o(c,{class:"mb-4"},{default:a(()=>[o(y,null,{default:a(()=>t[7]||(t[7]=[n("Member Balances")])),_:1}),o(A,null,{default:a(()=>[(u(!0),S(w,null,_(g.value,e=>(u(),f(h,{key:e.member,title:e.member},{append:a(()=>[m("span",{class:q(e.amount>=0?"text-success":"text-error")},p(e.amount>=0?"+":"")+"₹"+p(Math.abs(e.amount)),3)]),_:2},1032,["title"]))),128))]),_:1})]),_:1}),o(D,null,{default:a(()=>[o(I),o(C,{color:"primary",loading:v.value,disabled:!$.value,onClick:E},{default:a(()=>t[8]||(t[8]=[n(" Confirm Settlement ")])),_:1},8,["loading","disabled"])]),_:1}),o(z,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=e=>d.value=e),"max-width":"400"},{default:a(()=>[o(c,null,{default:a(()=>[o(y,null,{default:a(()=>t[9]||(t[9]=[n("Confirm Settlement")])),_:1}),o(k,null,{default:a(()=>t[10]||(t[10]=[n(" Are you sure you want to settle this episode? This action cannot be undone. ")])),_:1}),o(D,null,{default:a(()=>[o(I),o(C,{text:"",onClick:t[0]||(t[0]=e=>d.value=!1)},{default:a(()=>t[11]||(t[11]=[n("Cancel")])),_:1}),o(C,{color:"primary",onClick:N},{default:a(()=>t[12]||(t[12]=[n("Confirm")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{et as default};
